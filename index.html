<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>Chromecast Test</title>
    <script type="text/javascript" src="https://www.gstatic.com/cv/js/sender/v1/cast_sender.js?loadCastFramework=1"></script>
  </head>
  <body>
    <h1>Cast Test</h1>
    <button is="google-cast-button" style="height: 50px; width: 50px;"></button>

    <script>
      window.__onGCastApiAvailable = function(isAvailable) {
        if (isAvailable) {
          initializeCast();
        }
      };

      function initializeCast() {
        cast.framework.CastContext.getInstance().setOptions({
          receiverApplicationId: chrome.cast.media.DEFAULT_MEDIA_RECEIVER_APP_ID,
          autoJoinPolicy: chrome.cast.AutoJoinPolicy.ORIGIN_SCOPED
        });

        const context = cast.framework.CastContext.getInstance();
        context.addEventListener(cast.framework.CastContextEventType.SESSION_STATE_CHANGED, function(event) {
          if (event.sessionState === cast.framework.SessionState.SESSION_STARTED) {
            const mediaInfo = new chrome.cast.media.MediaInfo(
              'https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3',
              'audio/mpeg'
            );
            const request = new chrome.cast.media.LoadRequest(mediaInfo);
            context.getCurrentSession().loadMedia(request).then(
              () => console.log('Cast succeeded'),
              (e) => console.error('Cast failed', e)
            );
          }
        });
      }
    </script>
  </body>
</html>
