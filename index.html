<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Radio Als Chromecast</title>
  <script type="text/javascript" src="https://www.gstatic.com/cv/js/sender/v1/cast_sender.js?loadCastFramework=1"></script>
  <style>
    body {
      background: black;
      color: white;
      font-family: sans-serif;
      text-align: center;
      padding-top: 50px;
    }
    #cast-button {
      background: none;
      border: none;
      width: 64px;
      height: 64px;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <h1>Radio Als Chromecast Player</h1>
  <button id="cast-button" title="Cast to Chromecast">
    <img src="https://www.gstatic.com/cast/sdk/icons/button_cast_white.svg" alt="Cast" width="100%">
  </button>

  <script>
    // Wait for the Cast SDK to load before accessing it
    window.__onGCastApiAvailable = function(isAvailable) {
      console.log("Cast SDK available?", isAvailable);

      if (isAvailable) {
        initializeCast();
      }
    };

    function initializeCast() {
      console.log("Initializing Cast...");

      const context = cast.framework.CastContext.getInstance();
      context.setOptions({
        receiverApplicationId: chrome.cast.media.DEFAULT_MEDIA_RECEIVER_APP_ID,
        autoJoinPolicy: chrome.cast.AutoJoinPolicy.ORIGIN_SCOPED
      });

      const castButton = document.getElementById("cast-button");

      castButton.addEventListener("click", async () => {
        console.log("Cast button clicked");

        try {
          const session = await context.requestSession();
          console.log("Session started");

          const mediaInfo = new chrome.cast.media.MediaInfo(
            'https://stream.classicpop.dk/radioals',
            'audio/mpeg'
          );

          mediaInfo.metadata = new chrome.cast.media.MusicTrackMediaMetadata();
          mediaInfo.metadata.title = "Radio Als â€“ Classic Pop";

          const request = new chrome.cast.media.LoadRequest(mediaInfo);

          session.loadMedia(request).then(
            () => console.log("Media successfully loaded and casting"),
            err => console.error("Media load failed", err)
          );
        } catch (err) {
          console.error("Cast session error:", err);
        }
      });
    }
  </script>
</body>
</html>
