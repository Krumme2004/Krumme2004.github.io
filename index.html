<!DOCTYPE html>
<html>
<head>
  <title>Radio Als Cast</title>
  <meta charset="UTF-8" />
  <script type="text/javascript" src="https://www.gstatic.com/cv/js/sender/v1/cast_sender.js?loadCastFramework=1"></script>
  <style>
    #cast-button {
      background: none;
      border: none;
      width: 48px;
      height: 48px;
      cursor: pointer;
    }
  </style>
</head>
<body style="background-color: black; color: white;">
  <h1>Radio Als Chromecast</h1>

  <button id="cast-button" title="Cast to device">
    <img src="/assets/cast-icon.svg" alt="Cast" width="100%" />
  </button>

  <script>
    window['__onGCastApiAvailable'] = function(isAvailable) {
      if (!isAvailable) return;

      const context = cast.framework.CastContext.getInstance();
      context.setOptions({
        receiverApplicationId: chrome.cast.media.DEFAULT_MEDIA_RECEIVER_APP_ID,
        autoJoinPolicy: chrome.cast.AutoJoinPolicy.ORIGIN_SCOPED
      });

      document.getElementById("cast-button").addEventListener("click", async () => {
        try {
          const session = await context.requestSession();
          const mediaInfo = new chrome.cast.media.MediaInfo('https://stream.classicpop.dk/radioals', 'audio/mpeg');
          mediaInfo.metadata = new chrome.cast.media.MusicTrackMediaMetadata();
          mediaInfo.metadata.title = "Radio Als - Classic Pop";

          const request = new chrome.cast.media.LoadRequest(mediaInfo);
          session.loadMedia(request).then(
            () => console.log("Casting started"),
            (err) => console.error("Load failed:", err)
          );
        } catch (e) {
          console.error("Cast failed:", e);
        }
      });
    };
  </script>
</body>
</html>
